<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="Responsive Admin &amp; ">
	<meta name="author" content="#">
	<meta name="keywords" content=" bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link rel="shortcut icon" href="img/icons/icon-48x48.png" />


	<title>Dashboard | Employee  Mgt</title>

	<link href="css/app.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">


	<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

</head>

<body>


	<div class="wrapper">
		<nav id="sidebar" class="sidebar js-sidebar">
			<div class="sidebar-content js-simplebar">
				<a class="sidebar-brand" href="/home">
          <span class="align-middle">Employee Mgt</span>
        </a>

				<ul class="sidebar-nav">
					<li class="sidebar-header">
						Menu
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="/home">
              <i class="align-middle" data-feather="sliders"></i> <span class="align-middle">Dashboard</span>
            </a>
					</li>

					

				

					<li class="sidebar-item">
						<a class="sidebar-link modal-trigger" href="#" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">
							<i class="align-middle" data-feather="user-plus"></i> <span class="align-middle">Add Employee</span>
						</a>
					</li>
					
					

				
				        <li class="sidebar-item">
							<a class="sidebar-link" href="/logout">
							<i class="align-middle" data-feather="user"></i> <span class="align-middle">Logout</span>
							</a>
						</li>
					
			
				
				
				

		

				
				</ul>




			
			</div>
		</nav>

		<div class="main">
			<nav class="navbar navbar-expand navbar-light navbar-bg">
				<a class="sidebar-toggle js-sidebar-toggle">
          <i class="hamburger align-self-center"></i>
        </a>

				<div class="navbar-collapse collapse">
					<ul class="navbar-nav navbar-align">
						<li class="nav-item dropdown">
							<a class="nav-icon dropdown-toggle" href="#" id="alertsDropdown" data-bs-toggle="dropdown">
								<div class="position-relative">
									<i class="align-middle" data-feather="bell"></i>
									<span class="indicator"></span>
								</div>
							</a>
							<div class="dropdown-menu dropdown-menu-lg dropdown-menu-end py-0" aria-labelledby="alertsDropdown">
								<div class="dropdown-menu-header">
									Notifications
								</div>
								<div class="list-group">
								
								
									<a href="#" class="list-group-item">
										<div class="row g-0 align-items-center">
											<div class="col-2">
												<i class="text-primary" data-feather="home"></i>
											</div>
											<div class="col-10">
												<div class="text-dark">Login from 192.186.1.8</div>
												<div class="text-muted small mt-1">5h ago</div>
											</div>
										</div>
									</a>
								
								</div>
								<div class="dropdown-menu-footer">
									<a href="#" class="text-muted">Show all notifications</a>
								</div>
							</div>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-icon dropdown-toggle" href="#" id="messagesDropdown" data-bs-toggle="dropdown">
								<div class="position-relative">
									<i class="align-middle" data-feather="message-square"></i>
								</div>
							</a>
							<div class="dropdown-menu dropdown-menu-lg dropdown-menu-end py-0" aria-labelledby="messagesDropdown">
								<div class="dropdown-menu-header">
									<div class="position-relative">
									Messages
									</div>
								</div>
							
								<div class="dropdown-menu-footer">
									<a href="#" class="text-muted">Show all messages</a>
								</div>
							</div>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-icon dropdown-toggle d-inline-block d-sm-none" href="#" data-bs-toggle="dropdown">
                <i class="align-middle" data-feather="settings"></i>
              </a>

							<a class="nav-link dropdown-toggle d-none d-sm-inline-block" href="#" data-bs-toggle="dropdown">
                                <img src="img/avatars/avatar.jpg" class="avatar img-fluid rounded me-1" alt="" />
                                <span class="text-dark"><%= user ? user.fullName : 'Guest' %></span>
                                
              </a>
							<div class="dropdown-menu dropdown-menu-end">
								<a class="dropdown-item" href="#"><i class="align-middle me-1" data-feather="user"></i> Profile</a>
								<a class="dropdown-item" href="#"><i class="align-middle me-1" data-feather="pie-chart"></i> Analytics</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="#"><i class="align-middle me-1" data-feather="settings"></i> Settings & Privacy</a>
								<a class="dropdown-item" href="#"><i class="align-middle me-1" data-feather="help-circle"></i> Help Center</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="#">Log out</a>
							</div>
						</li>
					</ul>
				</div>
			</nav>

			<main class="content">
				<div class="container-fluid p-0">

					<h1 class="h3 mb-3">Welcome : <%= user ? user.fullName : 'Guest' %> </h1>




					<div class="row">
						<div class="col-12">

                            <% if (typeof message !== 'undefined' && typeof status !== 'undefined') { %>
                                <div class="alert alert-<%= status %>" role="alert">
                                    <%= message %>
                                </div>
                            <% } %>

							
                            
							<div class="card">

								<div class="card-header">
									
									<figure>
                                        <blockquote class="blockquote">
											
											<p>Employee Listing -.
												<a href="#" class="btn btn-primary" id="triggerModalButton">
													<i class="align-middle me-2" data-feather="user-plus"></i> 
												</a>
											</p>
											
											
										  
                                        </blockquote>
                                        <figcaption class="blockquote-footer">
                                          We are going to list all employee in the system    <cite title="Source Title"> CLICK </cite> the employee to view the details
                                        </figcaption>
                                      </figure>
								</div>

								<div class="card-body">


                                    <table id="employeesTable" class="display">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Position</th>
                                                <th>Department</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% employees.forEach(function(employee) { %>
                                                <tr>
                                                    <td><%= employee.fullName %></td>
                                                    <td><%= employee.email %></td>
                                                    <td><%= employee.position %></td>
                                                    <td><%= employee.department %></td>

                                                    <td>

                                                        
                                                        <a href="#" class="btn btn-primary"   onclick="fillEditModal('<%= employee._id %>','<%= employee.fullName %>', '<%= employee.email %>', '<%= employee.position %>', '<%= employee.department %>')">
                                                            <i class="align-middle me-2" data-feather="edit-3"></i> 
                                                        </a>
                                                        
                                                      <a href="#" class="btn btn-primary" id="deletelink" onclick="deleteEmployee('<%= employee._id %>', '<%= employee.fullName %>', '<%= employee.position %>', '<%= employee.department %>')">
                                                            <i class="text-danger align-middle me-2" data-feather="trash-2"></i> 
                                                        </a>

                                                        
                                                    </td>
                                                </tr>
                                            <% }); %>
                                        </tbody>
                                    </table>
                                    

								</div>

							</div>
						</div>
					</div>






				</div>


              
				<div id="piecontainer"></div>
                                         
<!-- Edit Employee Modal -->
<div class="modal fade" id="editEmployeeModal" tabindex="-1" aria-labelledby="editEmployeeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editEmployeeModalLabel">Edit Employee</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

        
            <form id="editEmployeeForm" method="post" action="/updateEmployee">
         
            <div class="mb-3">
            <input type="hidden" id="employeeId" name="employeeId">
              <label class="form-label">Full Name</label>
              <input type="text" class="form-control" id="employeeName"  name="employeeName" required >
            </div>

			<div class="mb-3">
                <label  class="form-label">email</label>
                <input type="text" class="form-control" id="employeeEmail" name="employeeEmail" readonly>
              </div>
            <div class="mb-3">
                <label  class="form-label">Position</label>
                <input type="text" class="form-control" id="employeePosition" name="employeePosition" required>
              </div>
              <div class="mb-3">
                <label  class="form-label">Department</label>
                <input type="text" class="form-control" id="employeeDepartment" name="employeeDepartment" required>
              </div>
          
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary">Save changes</button>
      
              </div>

            </form>
        </div>
       
      </div>
    </div>
  </div>
  <!--------------------------------------------------->


  
                                         
<!-- Add Employee Modal -->
<div class="modal fade" id="addEmployeeModal" tabindex="-1" aria-labelledby="addEmployeeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addEmployeeModalLabel">Add Employee</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

        
            <form id="AddEmployeeForm" method="post" action="/addEmployee">
         
            <div class="mb-3">
            
              <label class="form-label">Full Name</label>
              <input type="text" class="form-control" name="AddName" max="50" placeholder="Enter your full name" required  >
            </div>

			<div class="mb-3">
                <label  class="form-label">email</label>
                <input type="text" class="form-control" id="AddEmail" name="AddEmail" placeholder="Enter your email" required pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$">
              </div>
			  <div class="mb-3 ">
				<label class="form-label small-text">Phone <span class="text-muted" style="font-size: smaller;">(Format: +1##########)</span></label>
				<input class="form-control form-control-sm" type="tel" name="Addphone" placeholder="+1##########" required pattern="\+\d{1,3}\d{3}\d{3}\d{4}" />
			</div>

			<div class="mb-3 ">
				<label class="form-label small-text">Position</label>
				<input class="form-control form-control-sm" type="text" name="Addposition" placeholder="Enter your position" required />
			</div>
			<div class="mb-3 ">
				<label class="form-label small-text">Department</label>
				<select class="form-control form-control-sm" name="Adddepartment" required>
					<option value="">Select Department</option>
					<option value="Engineering">Engineering</option>
					<option value="Sales">Sales</option>
					<option value="HR">HR</option>
				</select>
			</div>

			<div class="mb-3 small-margin-bottom">
				<label class="form-label small-text">Password</label>
				<input class="form-control form-control-sm" type="password" name="Addpassword" placeholder="Enter your pasword" required />
			</div>

             <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary">Save changes</button>
      
              </div>

            </form>
        </div>
       
      </div>
    </div>
  </div>
  <!--------------------------------------------------->




			</main>



   

			<footer class="footer">
				<div class="container-fluid">
					<div class="row text-muted">
						<div class="col-6 text-start">
							<p class="mb-0">
								<a class="text-muted" href="#" target="_blank"><strong>Employee Mgt</strong></a> - <a class="text-muted" href="/home" target="_blank"></a>								&copy; <em>Developed by Tawanda Dadirai</em>
 
							</p>
						</div>
						<div class="col-6 text-end">
							<ul class="list-inline">
								<li class="list-inline-item">
									<a class="text-muted" href="#" target="_blank">Support</a>
								</li>
								<li class="list-inline-item">
									<a class="text-muted" href="#" target="_blank">Help Center</a>
								</li>
								<li class="list-inline-item">
									<a class="text-muted" href="#" target="_blank">Privacy</a>
								</li>
								<li class="list-inline-item">
									<a class="text-muted" href="#" target="_blank">Terms</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</footer>
		</div>
	</div>

	<script src="js/app.js"></script>

    <script>
        $(document).ready( function () {
            $('.display').DataTable({
                dom: 'Bfrtip',
                pageLength: 10 , 
                buttons: [
                    'copy', 'csv', 'excel', 'pdf', 'print'
                ]
            });


        });
        </script>
        

        <script>
            function fillEditModal(id, name,email, position, department) {
                document.getElementById('employeeId').value = id;
                document.getElementById('employeeName').value = name;
				document.getElementById('employeeEmail').value = email;
                document.getElementById('employeePosition').value = position;
                document.getElementById('employeeDepartment').value = department;                
                //document.getElementById('editEmployeeForm').action = '/update/' + id;
                var myModal = new bootstrap.Modal(document.getElementById('editEmployeeModal'), {});
                myModal.show();
            }
            </script>
            

			<script>
				function deleteEmployee(employeeId) {
					if (confirm('Are you sure you want to delete this employee?')) {
						fetch('/deleteEmployee/' + employeeId, {
							method: 'DELETE'
						}).then(response => response.json())
						  .then(data => {
							if (data.success) {
								window.location.href = '/home?message=' + encodeURIComponent(data.message) + '&status=success';
							} else {
								window.location.href = '/home?message=' + encodeURIComponent(data.message) + '&status=danger';
							}
						});
					}
				}
				
				</script>

				<script>
					document.getElementById('addEmployeeButton').addEventListener('click', function() {
						var myModal = new bootstrap.Modal(document.getElementById('addEmployeeModal'));
						myModal.show();
					});
				</script>
				

				<script>
					
					if (document.querySelector('.alert')) {						
						setTimeout(function() {
							document.querySelector('.alert').style.display = 'none';
						}, 5000); 
					}
				</script>
				
				<script>
					document.getElementById('triggerModalButton').addEventListener('click', function() {
						var myModal = new bootstrap.Modal(document.getElementById('addEmployeeModal'));
						myModal.show();
					});
				</script>



				<script>
					// Fetch the department data from the backend
fetch('/api/departmentCounts')
.then(response => response.json())
.then(departmentData => {
	// Convert the data into the format expected by Highcharts
	const formattedData = departmentData.map(item => ({
		name: item._id, 
		y: item.count   
	}));

	
	Highcharts.chart('piecontainer', {
		chart: {
			type: 'pie'
		},
		title: {
			text: 'Departmental count ',
			align: 'left'
		},
		subtitle: {
			text: 'We are displaying the stats of departments using Highcharts library',
			align: 'left'
		},
		tooltip: {
			pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
		},
		accessibility: {
			point: {
				valueSuffix: '%'
			}
		},
		plotOptions: {
			pie: {
				allowPointSelect: true,
				borderWidth: 2,
				cursor: 'pointer',
				dataLabels: {
					enabled: true,
					format: '<b>{point.name}</b>: {point.percentage:.1f} %',
					distance: 20
				}
			}
		},
		series: [{
			
			enableMouseTracking: false,
			animation: {
				duration: 2000
			},
			colorByPoint: true,
			data: formattedData 
		}]
	});
})
.catch(error => {
	console.error('Error fetching department data:', error);
});


				</script>
			

</body>

</html>